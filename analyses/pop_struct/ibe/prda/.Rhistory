library(vegan)
library(adegenet)
library(spdep)
library(adespatial)
library(splancs)
##############################
#conduct sPCA using adegenet
##############################
#read genind of quoll genotypes
stq <- readRDS("stq_genind")
#Read XY coordinates, they must all be unique, use the jitter function#
XY <- read.table(file="latlongs", header=T, sep="\t")
# Matrix needs diff name than coordinates#
xy.jitter <- matrix(ncol=2, nrow=345)
#The XY[,1] is  adding noise to the first column (i.e., X coordinates) and XY[,2] is the second column/Y coordinates#
xy.jitter[,1] <- jitter(XY[,1], a=0.01)
xy.jitter[,2] <- jitter(XY[,2], a=0.01)
#Scores for resultant sPCA, these are the response variables in the RDA. Can copy and paste them from R into a text document, or write a table in R#
spca_scores <- data.frame(id=row.names(mySpca$li), mySpca$li)
#if not re-running above code, load in our results
mySpca <- readRDS("spca_results.gz")
#Scores for resultant sPCA, these are the response variables in the RDA. Can copy and paste them from R into a text document, or write a table in R#
spca_scores <- data.frame(id=row.names(mySpca$li), mySpca$li)
#load in env data
##removed col 10 because zero variance
env_all <- read.table(file="env_all_yeardec", header=T, sep="\t")[,-10]
#load in collection years
dates <- read.table("stq_dates_yeardec", sep="\t", header=TRUE)
#format data
env_new <- data.frame(env_all, year=dates$yeardec)
colnames(env_new) <- c("bio1", "bio2", "bio3", "bio4", "bio12", "bio15", "elev", "tasveg_mod", "tasveg_def", "tasveg_mol", "tasveg_ngl", "tasveg_nef", "tasveg_raf", "tasveg_swl", "tasveg_scr", "tasveg_wef", "tasveg_oth", "gen_dftd", "gen5_devil", "gen10_devil", "gen15_devil", "year")
#bind genetic data, latlongs, and environmental data together
stq_env_df<-data.frame(spca_scores[,1:3], XY, env_new)
#remove variable with max VIF one at a time until all remaining variables have VIF<10
try <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,6]+stq_env_df[,7]+stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,11]+stq_env_df[,12]+stq_env_df[,13]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,24]+stq_env_df[,25]+stq_env_df[,26]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try)
max(vif.cca(try), na.rm=TRUE)
try2 <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,6]+stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,11]+stq_env_df[,12]+stq_env_df[,13]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,24]+stq_env_df[,25]+stq_env_df[,26]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try2)
max(vif.cca(try2), na.rm=TRUE)
try3 <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,11]+stq_env_df[,12]+stq_env_df[,13]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,24]+stq_env_df[,25]+stq_env_df[,26]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try3)
max(vif.cca(try3), na.rm=TRUE)
try4 <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,11]+stq_env_df[,12]+stq_env_df[,13]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,24]+stq_env_df[,25]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try4)
max(vif.cca(try4), na.rm=TRUE)
try5 <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,11]+stq_env_df[,12]+stq_env_df[,13]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,25]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try5)
max(vif.cca(try5), na.rm=TRUE)
try6 <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,11]+stq_env_df[,12]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,25]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try6)
max(vif.cca(try6), na.rm=TRUE)
try7 <- rda(stq_env_df[,2]+stq_env_df[,3]~stq_env_df[,8]+stq_env_df[,9]+stq_env_df[,10]+stq_env_df[,12]+stq_env_df[,14]+stq_env_df[,15]+stq_env_df[,16]+stq_env_df[,17]+stq_env_df[,18]+stq_env_df[,19]+stq_env_df[,20]+stq_env_df[,21]+stq_env_df[,23]+stq_env_df[,25]+Condition(stq_env_df[,4]+stq_env_df[,5]+stq_env_df[,27]))
vif.cca(try7)
#Max VIF is 11.45 and is Longitude - decide to keep it
max(vif.cca(try7), na.rm=TRUE)
View(stq_env_df)
#if not re-running above code, load in our results
sel3 <- readRDS("prda_sel3_wtime.gz")
#Analysis variance of final selection model
RDAc_sel3_marg <- anova.cca(sel3, by="margin")
library(vegan)
library(adegenet)
library(spdep)
library(adespatial)
library(splancs)
#Analysis variance of final selection model
RDAc_sel3_marg <- anova.cca(sel3, by="margin")
rownames(RDAc_sel3_marg) <- c(colnames(stq_env_df)[c(12,10,20,15,23,8,19,14,9)], "Residual")
#read genind of quoll genotypes
stq <- readRDS("stq_genind")
#Read XY coordinates, they must all be unique, use the jitter function#
XY <- read.table(file="latlongs", header=T, sep="\t")
# Matrix needs diff name than coordinates#
xy.jitter <- matrix(ncol=2, nrow=345)
#The XY[,1] is  adding noise to the first column (i.e., X coordinates) and XY[,2] is the second column/Y coordinates#
xy.jitter[,1] <- jitter(XY[,1], a=0.01)
xy.jitter[,2] <- jitter(XY[,2], a=0.01)
#if not re-running above code, load in our results
mySpca <- readRDS("spca_results.gz")
#Scores for resultant sPCA, these are the response variables in the RDA. Can copy and paste them from R into a text document, or write a table in R#
spca_scores <- data.frame(id=row.names(mySpca$li), mySpca$li)
#load in env data
##removed col 10 because zero variance
env_all <- read.table(file="env_all_yeardec", header=T, sep="\t")[,-10]
#load in collection years
dates <- read.table("stq_dates_yeardec", sep="\t", header=TRUE)
#format data
env_new <- data.frame(env_all, year=dates$yeardec)
colnames(env_new) <- c("bio1", "bio2", "bio3", "bio4", "bio12", "bio15", "elev", "tasveg_mod", "tasveg_def", "tasveg_mol", "tasveg_ngl", "tasveg_nef", "tasveg_raf", "tasveg_swl", "tasveg_scr", "tasveg_wef", "tasveg_oth", "gen_dftd", "gen5_devil", "gen10_devil", "gen15_devil", "year")
#bind genetic data, latlongs, and environmental data together
stq_env_df<-data.frame(spca_scores[,1:3], XY, env_new)
#Analysis variance of final selection model
RDAc_sel3_marg <- anova.cca(sel3, by="margin")
rownames(RDAc_sel3_marg) <- c(colnames(stq_env_df)[c(12,10,20,15,23,8,19,14,9)], "Residual")
RDAc_sel3_marg
?anova.cca
sum(RDA_sel3_marg$)
View(RDAc_sel3_marg)
View(RDAc_sel3_marg[,2])
sum(RDAc_sel3_marg[,2])
sum(RDAc_sel3_marg[-10,2])/sum(RDAc_sel3_marg[,2])
#Analysis variance of final selection model
RDAc_sel3_marg <- anova.cca(sel3, by="margin")
rownames(RDAc_sel3_marg) <- c(colnames(stq_env_df)[c(12,10,20,15,23,8,19,14,9)], "Residual")
RDAc_sel3_marg
summary(RDAc_sel3_marg)
#get adjusted Rsquared of final model
RsquareAdj(sel3)
chisq.test(x=0.387768, 1)
?chisq.test
pchisq(q=0.387768, df=1, lower.tail=FALSE)
pchisq(q=0.387768, df=1, lower.tail=TRUE)
pchisq(q=41.95973, df=1, lower.tail=TRUE)
pchisq(q=41.95973, df=1, lower.tail=FALSE)
1/999
2/999
sum(RDAc_sel3_marg[-10,2])/sum(RDAc_sel3_marg[,2])
sum(RDAc_sel3_marg[,2])
sum(RDAc_sel3_marg[-10,2])
pchisq(4.73629,1, lower.tail=FALSE)
?pchisq
43/14
43.62/14.540
158/43
158.47/43.62
3.068151/0.387768
4/0.387768
85/583
summary(sel3)
?pf
pf(4.73629, 1, 332)
pf(4.73629, 1, 332, lower.tail=FALSE)
RDAc_sel3_marg
#Analysis variance of final selection model
RDAc_sel3_marg <- anova.cca(sel3, by="margin")
summary(RDAc_sel3_marg)
rownames(RDAc_sel3_marg) <- c(colnames(stq_env_df)[c(12,10,20,15,23,8,19,14,9)], "Residual")
RDAc_sel3_marg
0.38777/(3.06815/332)
?ordiR2step
0.387768/(3.068151/332)
?var.test
0.135097/(3.068151/332)
confint(sel3)
confint(RDAc_sel3_marg)
?qf
qf(c(0.95), n=345, df1=1, df2=332)
pf(q=14.61864, df1=1, df2=345, lower.tail=FALSE)
pf(q=14.61864, df1=1, df2=332, lower.tail=FALSE)
pf(q=4.73629, df1=1, df2=332, lower.tail=FALSE)
#Analysis variance of final selection model
RDAc_sel3_marg <- anova.cca(sel3, by="margin")
View(RDAc_sel3_marg)
summary(sel3)
#get adjusted Rsquared of final model
RsquareAdj(sel3)
